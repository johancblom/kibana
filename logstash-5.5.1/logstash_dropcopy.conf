input {
	file {
		path => "/vagrant/dc.log"
		start_position => "beginning"
	}
}
filter {
	grok {
		match => ["message", "%{TIME:timestamp} %{GREEDYDATA: fix_session}: %{GREEDYDATA:fix_string}"]
	}
	mutate {
		gsub => [
			"fix_string", "654=.*555=\d\u0001",""
		]
	}
	if [message] =~ /35=8.*49=PULSE_DROP/ or [message] =~ /35=8.*49=FLXPLSDC/ or [message] =~ /35=8.*49=PULSEDROP/ or [message] =~ /49=PULSE_DROP.*35=8/ or [message] =~ /49=FLXPLSDC.*35=8/ or [message] =~ /49=PULSEDROP.*35=8/ {
		fix_protocol {
			fix_message => fix_string
			data_dictionary_path => "/vagrant/clientFIXDictionary.xml"
		}
       		date {
			match => ["SendingTime", "YYYYMMDD-HH:mm:ss.SSS"]
		}	
	}
	else {
		drop { }
	}
}
output {
  stdout {
    codec => rubydebug
  }
  elasticsearch {
   hosts => "localhost:9200"
   index => "dropcopies"
 }
}
